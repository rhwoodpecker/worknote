## æ‹–æ‹½äº‹ä»¶
**éœ€è¦ç”¨åˆ°çš„æ‹–æ‹½äº‹ä»¶**
- `dragenter`ï¼šå½“æ‹–åŠ¨çš„å…ƒç´ æˆ–è¢«é€‰æ‹©çš„æ–‡æœ¬è¿›å…¥æœ‰æ•ˆçš„æ”¾ç½®ç›®æ ‡æ—¶ï¼Œ `dragenter` äº‹ä»¶è¢«è§¦å‘ã€‚
- `dragleave`ï¼šå½“ä¸€ä¸ªè¢«æ‹–åŠ¨çš„å…ƒç´ æˆ–è€…è¢«é€‰æ‹©çš„æ–‡æœ¬ç¦»å¼€ä¸€ä¸ªæœ‰æ•ˆçš„æ‹–æ”¾ç›®æ ‡æ—¶ï¼Œå°†ä¼šè§¦å‘ `dragleave` äº‹ä»¶ã€‚
- `dragover`ï¼šå½“å…ƒç´ æˆ–è€…é€‰æ‹©çš„æ–‡æœ¬è¢«æ‹–æ‹½åˆ°ä¸€ä¸ªæœ‰æ•ˆçš„æ”¾ç½®ç›®æ ‡ä¸Šæ—¶ï¼Œè§¦å‘ `dragover` äº‹ä»¶(æ¯å‡ ç™¾æ¯«ç§’è§¦å‘ä¸€æ¬¡)ã€‚è¿™ä¸ªäº‹ä»¶åœ¨å¯è¢«æ”¾ç½®å…ƒç´ çš„èŠ‚ç‚¹ä¸Šè§¦å‘ã€‚(å¿…é¡»é˜»æ­¢é»˜è®¤è¡Œä¸ºæ‰èƒ½è§¦å‘ `drop` äº‹ä»¶)
- `drop`ï¼šå½“ä¸€ä¸ªå…ƒç´ æˆ–æ˜¯é€‰ä¸­çš„æ–‡å­—è¢«æ‹–æ‹½é‡Šæ”¾åˆ°ä¸€ä¸ªæœ‰æ•ˆçš„é‡Šæ”¾ç›®æ ‡ä½ç½®æ—¶ï¼Œ`drop` **äº‹ä»¶è¢«æŠ›å‡º**

## å®ç°æ€è·¯
1. åœ¨æ¯ä¸ªä¼šè¯ä¸Šé¢æ·»åŠ ä¸€ä¸ªè’™æ¿ç”¨äºæ¥æ”¶ `drag` äº‹ä»¶
2. å½“é¼ æ ‡æ‹–æ‹½åˆ°ä¼šè¯åŒºåŸŸæ—¶å€™è’™æ¿è¾¹æ¡†å±•ç¤ºï¼Œç§»é™¤æ—¶å€™éšè—
3. `drop` äº‹ä»¶è§¦å‘æ—¶å€™æ¨¡æ‹Ÿä¼šè¯å…ƒç´ ç‚¹å‡»ï¼Œå³è’™æ¿ `click()` 
4. åˆ‡æ¢ä¼šè¯åå°†æ–‡ä»¶æ·»åŠ åˆ°è¾“å…¥æ¡†ï¼Œ`setTimeout` äº‹ä»¶å¾ªç¯

## ä¸Šä»£ç 
**çˆ¶ç»„ä»¶**
```js
// å­ç»„ä»¶refï¼Œä¾›è°ƒç”¨å­ç»„ä»¶æ–¹æ³•å¤„ç†æ–‡ä»¶
const inputRef = useRef(null);

// ä¸»ä½“ç»„ä»¶æŒ‚è½½å®Œæ¯•æ·»åŠ äº‹ä»¶ç›‘å¬
useEffect(() => {
    document.addEventListener('dragenter', handleDragenter, false); // æ‹–æ‹½æ—¶
    document.addEventListener('dragleave', handleDragleave, false); // æ‹–æ‹½ç¦»å¼€
    document.addEventListener('dragover', handleDragover, false); // é˜»æ­¢é»˜è®¤äº‹ä»¶å»è§¦å‘drop
    document.addEventListener('drop', handleDrop, false); // æ‹–æ‹½æ”¾å¼€äº‹ä»¶

    return () => {
        document.removeEventListener('dragenter', handleDragenter);
        document.removeEventListener('dragleave', handleDragleave);
        document.removeEventListener('dragover', handleDragover);
        document.removeEventListener('drop', handleDrop);
    }
}, []);

const handleDragenter = (event: DragEvent) => {
    event.preventDefault();
    // ç‰¹å®šdivæ‰ç»™äºˆåé¦ˆï¼Œé€šè¿‡ç±»åæ ‡è¯†
    const className = (event.target as HTMLDivElement)?.getAttribute('class');
    if (className?.includes('dialog-drag-wrapper')) {
        (event.target as HTMLDivElement).style.border = '2px solid #4894f4';
    }
};

const handleDragleave = (event: DragEvent) => {
    // ç¦»å¼€çš„æ—¶å€™æ¢å¤
    const className = (event.target as HTMLDivElement)?.getAttribute('class');
    if (className?.includes('dialog-drag-wrapper')) {
        (event.target as HTMLDivElement).style.border = 'none';
    }
};

const handleDragover = (event: DragEvent) => {
    // é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œæ‰èƒ½è§¦å‘dropäº‹ä»¶
    event.preventDefault();
};

const handleDrop = useCallback((event: DragEvent) => {
    // æ‹–æ‹½ç»“æŸ
    // è·å–æ‹–æ‹½æ–‡ä»¶
    const files = event.dataTransfer?.files;
    event.preventDefault();
    const className = (event.target as HTMLDivElement)?.getAttribute('class');
    if (className?.includes('dialog-drag-wrapper')) {
        // æ¢å¤æ‹–æ‹½æ¥æ”¶åŒºåŸŸæ ·å¼
        (event.target as HTMLDivElement).style.border = 'none';
        // æ¨¡æ‹Ÿæ‹–æ‹½åŒºåŸŸç‚¹å‡»äº‹ä»¶
        (event.target as HTMLDivElement).click();
        setTimeout(() => {
            // ç­‰å¾…ä¼šè¯åˆ‡æ¢å®Œæˆå¤„ç†è¾“å…¥æ¡†çš„æ–‡ä»¶
            // @ts-ignore
            inputRef?.current?.handleFiles(files);
        });
    }
}, []);

return (
    <div>
        ...
        <InputPannel cRef={inputRef} />
    </div>
)
```
**å­ç»„ä»¶è¾“å…¥æ¡†**
```js
interface InputPannelProps {
    cRef: any;
}

const InputPannel: React.FC<InputPannelProps> = ({ cRef }) => {
    // é€šè¿‡é’©å­ğŸªä¾›çˆ¶ç»„ä»¶è°ƒç”¨
    useImperativeHandle(cRef, () => ({
        handleFiles: (files) => {
            handleChangeFile(files);
        }
    }));

    const handleChangeFile = (files) => {
        // å¤„ç†æ–‡ä»¶åˆ—è¡¨ï¼Œå¯ä»¥å’Œé€‰æ‹©æ–‡ä»¶å…±ç”¨ä¸€å¥—é€»è¾‘,ç„¶åå°†æ–‡ä»¶æ¸²æŸ“åœ¨å¯ç¼–è¾‘divåŒºåŸŸ
    }

    return (
        <div>
            <div contentEditable={true} />
            <input type="file" onChange={(e) => handleChangeFile(e.target.files)}/>
        </div>
    )
}
```
## æ‹“å±•
æ‹–æ‹½èŠå¤©**æ–‡ä»¶ç»„ä»¶**åˆ°**æ¡Œé¢**æˆ–è€…**ä¼šè¯** 

å®ç°æ€è·¯
1. å°†æ–‡ä»¶ç»„ä»¶è®¾ç½®ä¸ºå¯æ‹–æ‹½ï¼Œ`draggable={true} `
2. å¼€å§‹æ‹–æ‹½çš„æ—¶å€™åˆ¤æ–­æ–‡ä»¶pathæœ¬åœ°æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨å°±å¼€å§‹ä¸‹è½½ï¼Œä¸‹è½½å®Œæˆå†æç¤ºç”¨æˆ·æ‹–æ‹½ï¼Œ`onDragStartCapture={(e) => doSomething()}`
3. æœ¬åœ°å·²ç»æœ‰æ–‡ä»¶æˆ–è€…ä¸‹è½½å¥½äº†ï¼Œæ¸²æŸ“è¿›ç¨‹å‘æ¶ˆæ¯ç»™ä¸»è¿›ç¨‹ï¼Œå¸¦ä¸Šæ–‡ä»¶**ç»å¯¹è·¯å¾„**å’Œ `icon`
4. ä¸»è¿›ç¨‹ç›‘å¬å¯¹åº”äº‹ä»¶å¹¶é€šè¿‡ `sttartDrag({filePath, icon})` æ–¹æ³•å¼€å¯åŸç”Ÿæ–‡ä»¶æ‹–æ”¾ï¼Œ[å‚è€ƒ](https://www.electronjs.org/zh/docs/latest/tutorial/native-file-drag-drop)

> æ–‡ä»¶æ¶ˆæ¯ç»„ä»¶
```js
const fileOnDrag = (e, message) => {
    e.preventDefault();
    // åˆ¤æ–­message çš„ locaPath æœ¬åœ°æœ‰æ— ï¼Œæ²¡æœ‰å°±ä¸‹è½½
    // å¦‚æœæœ‰åˆ™å‘æ¸²æŸ“è¿›ç¨‹å‘æ¶ˆæ¯
    ipcRenderer.send('ondragstart', {
        filePath, // æ–‡ä»¶çš„ç»å¯¹åœ°å€
        icon: /*è‡ªå·±åŒ…å†…ç›¸å¯¹è·¯å¾„è‡ªå®šä¹‰icon*/
    });
}

return (
    <div className={styles.fileBox1} draggable={true} onDragStartCapture={(e) => fileDragCopy(e, message)}>
        ...
    </div>      
)
```
> main.js
```js
ipcMain.on('ondragstart', (event, { filePath, icon }) => {
    event.sender.startDrag({
        file: filePath,
        icon: `${__dirname}/src/${icon}` // è‡ªå®šä¹‰ç»å¯¹è·¯å¾„
    });
});
```
> åº”ç”¨å†…æ‹–æ‹½æ•ˆæœ 
  
![æ–¹ç‰¹](https://user-images.githubusercontent.com/22131908/157356871-9a26535c-8757-4c96-bb20-e76d52beb8c6.gif)

> åº”ç”¨å†…æ¶ˆæ¯æ‹–æ‹½åˆ°ç³»ç»Ÿæ¡Œé¢

![æ–¹ç‰¹2](https://user-images.githubusercontent.com/22131908/157357059-0275ce34-e28b-415a-bff7-ce16cac67924.gif)

